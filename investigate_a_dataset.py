# -*- coding: utf-8 -*-
"""Investigate_a_Dataset.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/10ZzEt2_nvtlQBowp_yvTIId-jw6jexNP

# Project: Investigate a Dataset - [TMDb movie data]
Table of Contents:
Introduction

*   Introduction 
*   Data Wrangling
*   Exploratory Data Analysis
*   Conclusions

# Introduction
**Dataset Description**

*Dataset selected*:TMDb movie data This data set contains information about 10,000 movies collected from The Movie Database (TMDb), including user ratings and revenue. 

*Columns in the dataset:*
id - unique id of the movies in the dataset
imdb_id - unique id of the movies in the The Movie Database(TMDb)
popularity - popularity measure of each movie
budget - budget for making each movie	
revenue	- revenue made from the movie viewed by the audience 
original_title	- original title of the movie
cast - cast that acted in the movie	
homepage - link to website where the movie is located	
director - director who directed the movie	
tagline - tagline used to market the movie	
keywords - keywords used throughout the movie and match the movie theme/ genre	
overview - short description of the movie's storyline	
runtime - how much time it run for people to watch	
genres - the movie genre	
production_companies - companies which produced the movies	
release_date - date which the movie was released	
vote_count - total count of votes
vote_average - average of vote count	
release_year - year which the movie was released 
budget_adj	- budget adj 
revenue_adj - revenue adj

# Question(s) for Analysis


1. Which genres are most popular from year to year? 
2. Which Genres have the highest average revenue over the years?
3. Who are the most popular cast members in highest grossing movies?
"""

# Commented out IPython magic to ensure Python compatibility.
#import python packages
import pandas as pd 
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns 
# %matplotlib inline

import io
from google.colab import files

"""# Data Wrangling
General Properties
"""

#load dataset
uploaded = files.upload()

#print out dataset. Perform operations to inspect data
df = pd.read_csv(io.BytesIO(uploaded.get('tmdb-movies.csv')))
df.head()

# Shape of dataset
df.shape

#   types and look for instances of missing or possibly errant data.
df.info()

# Displaying the number of missing values for each column . 
df.isnull().sum()

# Checking for any duplicated rows:
df.duplicated().sum()

# display the duplicated data
df[df.duplicated()]

"""**Data Summary**"""

df.describe()

"""**Data Cleaning**"""

# Display the column indexes
df.columns

"""1. Drop data that isnt relevant for analysis

"""

df.drop(
    ['homepage','tagline','overview'\
     ,'imdb_id','id','release_date'], inplace = True, axis = 1)

# check for changes
df.columns

"""2.Drop missing values (NANs)"""

df.dropna(inplace = True)

"""3.drop rows that contain zeros values in (revenue_adj,budget_adj,runtime)"""

zero_data = df[(df.revenue_adj == 0)|(df.budget_adj == 0)|(df.runtime == 0)]
df.drop(zero_data.index,inplace=True)

df.head()

# info of the cleaned data
df.info()

# Descriptive statistics of the cleaned dataset
df.describe()

"""
Sorting data release data into decades for Exploratory analysis"""

bins_edges=[1960,1970,1980,1990,2000,2010,2015]
bins_names=['1960s','1970s','1980s','1990s','2000s','2010s']
df.release_year = pd.cut(df.release_year, bins_edges, labels = bins_names)

df.release_year.value_counts()

"""Separate the data contained in Cast & Genres columns into multiple values"""

# Columns like cast & genres contain several values separated by the "|" , so we separate these values to make a more appropriate analysis.
def seprate_values(col):
    new_cols=(df[col].str.split('|', expand=True).rename(columns=lambda x: f"{col}_{x+1}"))
    return new_cols

df_cast = seprate_values('cast')
df_gen = seprate_values('genres')

df['cast'],df['genres']=df_cast['cast_1'],df_gen['genres_1']

display(df['cast'].value_counts().nlargest(10))
print('-'*60)
display(df['genres'].value_counts().nlargest(10))

"""# Exploratory Data Analysis

Research Question 1 (Which genres are most popular from year to year? )
"""

df.groupby(["release_year","genres"])['popularity'].size().unstack()

fig, ax = plt.subplots(figsize=(14,10))
df.groupby(["release_year","genres"])['popularity'].size().unstack().plot(kind='bar',ax=ax,width=-.9,align='edge');
ax.set_ylabel('popularity');

"""The Top Three Genres for each decade are:

1960s: Adventure, Action, Drama

1970s: Action, Drama, Comedy

1980s: Action, Drama, Comedy

1990s: Drama, Comedy, Action

2000s: Drama, Comedy, Action

2010s: Drama, Comedy, Action

Research Question 2 ( Which genres have the highest average revenue over the years? )
"""

pd.pivot_table(df,index="release_year",columns="genres",values='revenue_adj',aggfunc=pd.Series.mean)

fig, ax = plt.subplots(figsize=(15,8))
pd.pivot_table(df,index="release_year",columns="genres",values='revenue_adj',aggfunc=pd.Series.mean).\
plot(kind='bar',ax=ax,width=-.9,align='edge');
ax.set_ylabel('revenue');

"""The Highest Grossing Revenue genre over the years are:

1960s: Adventure, Animation, Action.

1970s: Adventure, Drama, Music.

1980s: Adventure, Fantasy, Romance.

1990s: Family, Western, Adventure, Animation.

2000s: Animation, Adventure, Family.

2010s: Animation, Adventure, Science Fiction.

Research Question 3: (Who are the most popular cast members in highest grossing movies?)
"""

# Counting most popular cast members in popular movies:
top_100_df = df.sort_values(by='popularity', ascending=False).head(100)
top_100_cast = pd.Series(top_100_df['cast'].str.cat(sep='|').split('|'))
frequent_cast_in_top_100 = top_100_cast.value_counts(ascending=False).head(10)
frequent_cast_in_top_100.plot(kind='bar', figsize=(12, 8));
plt.xticks(rotation = 45, fontsize = 13) # labels for the x-axis
plt.yticks(fontsize = 13) # y-axis
plt.ylabel("Number of times they were cast", fontsize = 13) #title for the y-axis
plt.title("Most frequent cast members in popular movies", fontsize = 16, fontweight = "bold") #title for the chart

"""# Conclusions

**Data Limitations**
1. Alot of the data columns are irrelevant for analysis
2. There are several missing values in the dataset
3. The 0 values are treated as missing data

***Findings and results***

Question 1: Interest in movie genres varies overtime but the Most popular genres over the years are Drama, Action and Comedy.

Question 2: Adevnture is the most common genre in highest grossing revenue over the years.

Question 3: The results of this question mean that the appearance of one of these popular actors could contribute to the success of the movie.
"""